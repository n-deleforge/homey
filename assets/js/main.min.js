function displayApp(){document.title="HOMEY - "+settings.profile.name,displayTime(),setInterval(displayTime,1e3),get("#start").style.display="none",get("#app").style.display="flex","dark"==settings.profile.theme?displayTheme("dark"):"light"==settings.profile.theme&&displayTheme("light"),""!=settings.weather.api&&(get("#weatherMenuAPIValue").value=settings.weather.api),""!=settings.weather.town&&(get("#weatherMenuTownValue").value=settings.weather.town),1==settings.weather.activated?(get("#activateWeather").checked=!0,get("#weatherMenuAPI").style.display="flex",get("#weatherMenuTown").style.display="flex",get("#weatherMenuCheck").style.display="block"):(get("#activateWeather").checked=!1,get("#weatherMenuAPI").style.display="none",get("#weatherMenuTown").style.display="none",get("#weatherMenuCheck").style.display="none")}function displayTime(){let e=new Date,t=e.toLocaleString(display.misc.dateLanguage,{weekday:"long",month:"long",day:"numeric"}),n=e.getHours(),i=e.getMinutes();n<10&&(n="0"+n),i<10&&(i="0"+i),get("#displayTime").innerHTML=n+":"+i,get("#displayDate").innerHTML=t}function displayWeatherInfo(){1==settings.weather.activated&&""!=settings.weather.api&&""!=settings.weather.town?(requestWeather(),setInterval(requestWeather,18e5)):get("#displayWeather").innerHTML=""}function requestWeather(){const e=new XMLHttpRequest;e.onreadystatechange=function(){if(this.readyState===XMLHttpRequest.DONE&&200===this.status){let e,t=JSON.parse(this.responseText),n=new Date;if(n.getHours()<7||n.getHours()>19)e="🌙";else switch(t.weather[0].main){case"Clear":e="☀";case"Clouds":e="⛅";case"Drizzle":e="🌨";case"Rain":e="🌧";case"Snow":e="🌨";case"Thunderstorm":e="🌩";case"Atmosphere":e="🌪";case"Fog":e="🌫"}get("#displayWeather").innerHTML=e+" "+Math.round(t.main.temp)+" <sup>°c</sup>"}else get("#displayWeather").innerHTML="❗"},e.open("GET","https://api.openweathermap.org/data/2.5/weather?q="+settings.weather.town+"&appid="+settings.weather.api+"&lang="+display.misc.weatherLanguage+"&units=metric",!0),e.send(null)}function switchTheme(){switch(settings.profile.theme){case"dark":displayTheme("light"),settings.profile.theme="light",updateJSON();break;case"light":displayTheme("dark"),settings.profile.theme="dark",updateJSON()}}function displayTheme(e){"dark"==e&&(get("#theme").href="assets/css/theme-dark.min.css"),"light"==e&&(get("#theme").href="assets/css/theme-light.min.css")}function updateJSON(){storage("set","HOMEY-settings",JSON.stringify(settings))}function checkVersion(){settings.core.version!=version&&(settings.core.version=version,updateJSON())}function openWindow(e){get("#containerPopup").style.display="flex",get("#"+e).style.display="block"}function closeWindow(){get("#containerPopup").style.display="none";for(let e=0;e<get("#containerPopup").children.length;e++)get("#containerPopup").children[e].style.display="none"}0==settings.core.start?(get("#start").style.display="flex",get("#name").value="",get("#displayInitMenu").addEventListener("click",function(){openWindow("initMenu"),get("#closeInitMenu").addEventListener("click",closeWindow),get("#confirmInitMenu").addEventListener("click",function(){get("#name").checkValidity()&&""!=get("#name").value?(settings.core.start=!0,settings.profile.name=get("#name").value,updateJSON(),location.reload()):get("#initMenuCheck").style.color="red"})}),get("#displayImportMenu").addEventListener("click",function(){openWindow("importMenu"),get("#closeImportMenu").addEventListener("click",closeWindow),get("#importMenuConfirm").addEventListener("click",function(){if(0!=get("#importData").files.length){let e=new FileReader;e.readAsText(get("#importData").files[0]),e.onload=function(e){let t=e.target.result;settings=JSON.parse(t),updateJSON(),location.reload()}}else get("#importMenuCheck").innerHTML=display.misc.errorImport,get("#importMenuCheck").style.color="red"})})):(displayApp(),displayWeatherInfo(),checkVersion(),get("#displaySettings").addEventListener("click",function(){closeWindow(),get("#displaySettings").style.display="none",get("#listSettings").style.animation="fadeInRight",get("#listSettings").style.animationDuration="0.5s",get("#listSettings").style.display="flex"}),get("#closeSettings").addEventListener("click",function(){get("#displaySettings").style.display="block",get("#listSettings").style.display="none"}),get("#exportData").addEventListener("click",function(){download(JSON.stringify(settings),"homey.json")}),get("#switchTheme").addEventListener("click",switchTheme),get("#displayLogoutMenu").addEventListener("click",function(){openWindow("logoutMenu"),get("#closeLogoutMenu").addEventListener("click",closeWindow),get("#logoutMenuConfirm").addEventListener("click",function(){storage("rem","HOMEY-settings"),location.reload()})}),get("#displayProfilMenu").addEventListener("click",function(){openWindow("profilMenu"),get("#newName").value=settings.profile.name,get("#profilMenuConfirm").addEventListener("click",function(){get("#newName").checkValidity()&&""!=get("#newName").value?(get("#profilMenuCheck").style.color="white",settings.profile.name=get("#newName").value,updateJSON(),displayApp(),closeWindow()):get("#profilMenuCheck").style.color="red"})}),get("#displayWeatherMenu").addEventListener("click",function(){openWindow("weatherMenu"),get("#weatherMenuAPIValue").addEventListener("input",function(){settings.weather.api=get("#weatherMenuAPIValue").value,updateJSON()}),get("#weatherMenuTownValue").addEventListener("input",function(){settings.weather.town=get("#weatherMenuTownValue").value,updateJSON()}),get("#weatherMenuConfirm").addEventListener("click",function(){1==settings.weather.activated?""!=settings.weather.api&&""!=settings.weather.town?(get("#weatherMenuCheck").style.color="white",displayWeatherInfo(),closeWindow()):get("#weatherMenuCheck").style.color="red":(settings.weather.activated=!1,updateJSON(),displayWeatherInfo(),closeWindow())}),get("#activateWeather").addEventListener("change",function(){1==get("#activateWeather").checked?settings.weather.activated=!0:settings.weather.activated=!1,updateJSON(),displayApp()})}));