function firstStart(){get("#start").style.display="flex",get("#importData").value="",createMenu("start")}function loadApp(){get("#start").style.display="none",get("#app").style.display="flex",displayBasic(),setInterval(displayBasic,1e3),displayTheme("auto"),displayWeatherInfo(),checkVersion(),createMenu()}function createMenu(e){"start"==e?(get("#startApp").addEventListener("click",function(){SETTINGS.core.start=!0,updateData(),location.reload()}),get("#importConfirm").addEventListener("click",function(){if(0!=get("#importData").files.length){let e=new FileReader;e.readAsText(get("#importData").files[0]),e.onload=function(e){let t=e.target.result;SETTINGS=JSON.parse(t),updateData(),location.reload()}}else get("#importData").style.color=getVariableCSS("--errorText")})):(get("#displaySettings").addEventListener("click",function(){get("#blankPage").style.display="flex",get("#displaySettings").style.display="none",get("#listSettings").style.animation="fadeInRight",get("#listSettings").style.animationDuration="0.5s",get("#listSettings").style.display="flex"}),get("#closeSettings").addEventListener("click",closeMenu),get("#blankPage").addEventListener("click",closeMenu),get("#newName").value=SETTINGS.profile.name,get("#weatherAPIValue").value=SETTINGS.weather.api,get("#weatherTownValue").value=SETTINGS.weather.town,get("#profilConfirm").addEventListener("click",function(){get("#newName").checkValidity()&&""!=get("#newName").value?(get("#profilLabel").style.color=getVariableCSS("--popupTextColor"),SETTINGS.profile.name=get("#newName").value,updateData()):get("#profilLabel").style.color=getVariableCSS("--errorText")}),get("#weatherConfirm").addEventListener("click",function(){""!=get("#weatherAPIValue").value&&""!=get("#weatherTownValue").value?(get("#weatherAPILabel").style.color=getVariableCSS("--popupTextColor"),get("#weatherTownLabel").style.color=getVariableCSS("--popupTextColor"),SETTINGS.weather.api=get("#weatherAPIValue").value,SETTINGS.weather.town=get("#weatherTownValue").value,updateData(),displayWeatherInfo()):(get("#weatherAPILabel").style.color=getVariableCSS("--errorText"),get("#weatherTownLabel").style.color=getVariableCSS("--errorText"))}),get("#exportData").addEventListener("click",function(){confirm(_CONTENT.misc.backupText)&&download(JSON.stringify(SETTINGS),"homey.json")}),get("#switchTheme").addEventListener("click",switchTheme),get("#logout").addEventListener("click",function(){confirm(_CONTENT.misc.logoutText)&&(storage("rem","HOMEY-settings"),location.reload())}))}function closeMenu(){get("#displaySettings").style.display="block",get("#listSettings").style.display="none",get("#blankPage").style.display="none",get("#profilLabel").style.color=getVariableCSS("--labelText"),get("#weatherAPILabel").style.color=getVariableCSS("--labelText"),get("#weatherTownLabel").style.color=getVariableCSS("--labelText")}function displayBasic(){let e=new Date,t=e.toLocaleString(_CONTENT.misc.dateLanguage,{weekday:"long",month:"long",day:"numeric"}),a=e.getHours(),l=e.getMinutes();a<10&&(a="0"+a),l<10&&(l="0"+l);let i=e.getHours()<7||e.getHours()>19?_CONTENT.misc.welcomeNight:_CONTENT.misc.welcomeDay,r=""!=SETTINGS.profile.name?' <span id="displayName">'+SETTINGS.profile.name+"</span>":"";get("#displayTime").innerHTML=a+":"+l,get("#displayDate").innerHTML=t,get("#displayWelcome").innerHTML=i+r}function displayWeatherInfo(){""!=SETTINGS.weather.api&&""!=SETTINGS.weather.town?(requestWeather(),setInterval(requestWeather,18e5),get("#displayWeather").style.display="block"):(get("#displayWeather").innerHTML="",get("#displayWeather").style.display="none")}function requestWeather(){const e=new Request("https://api.openweathermap.org/data/2.5/weather?q="+SETTINGS.weather.town+"&appid="+SETTINGS.weather.api+"&lang="+_CONTENT.misc.weatherLanguage+"&units=metric");fetch(e).then(e=>e.json()).then(e=>{let t,a=new Date;if(a.getHours()<7||a.getHours()>19)t="üåô";else switch(e.weather[0].main){case"Clear":t="‚òÄÔ∏è";break;case"Clouds":t="‚õÖ";break;case"Drizzle":case"Rain":t="üåßÔ∏è";break;case"Snow":t="‚ùÑÔ∏è";break;case"Thunderstorm":case"Atmosphere":t="üå©Ô∏è";break;case"Fog":t="üå´Ô∏è";break;default:t="‚ùì"}get("#displayWeather").innerHTML=t+" "+Math.round(e.main.temp)+" <sup>¬∞c</sup>"}).catch(e=>{console.log(e),get("#displayWeather").innerHTML="‚ùì"})}function switchTheme(){switch(SETTINGS.profile.theme){case"dark":displayTheme("load","light"),SETTINGS.profile.theme="light",updateData();break;case"light":displayTheme("load","dark"),SETTINGS.profile.theme="dark",updateData()}}function displayTheme(e,t){if("auto"==e)displayTheme("load",SETTINGS.profile.theme);else switch(t){case"dark":get("#theme").href="assets/css/theme-dark.min.css";break;case"light":get("#theme").href="assets/css/theme-light.min.css"}}function updateData(){storage("set","HOMEY-settings",JSON.stringify(SETTINGS))}function checkVersion(){SETTINGS.core.version!=_VERSION&&(SETTINGS.core.version=_VERSION,updateData())}0==SETTINGS.core.start?firstStart():loadApp();