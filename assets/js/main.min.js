function createMenu(){get("#closeSettings").addEventListener("click",closeMenu),get("#blankPage").addEventListener("click",closeMenu),get("#displaySettings").addEventListener("click",()=>{get("#blankPage").style.display="flex",get("#displaySettings").style.display="none",get("#listSettings").style.animation="fadeInRight",get("#listSettings").style.animationDuration="0.5s",get("#listSettings").style.display="flex"}),get("#newName").value=settings.profile.name,get("#profileConfirm").addEventListener("click",changeProfile),get("#weatherAPIValue").value=settings.weather.api,get("#weatherTownValue").value=settings.weather.town,get("#weatherConfirm").addEventListener("click",changeWeather),get("#backgroundConfirm").addEventListener("click",modifyBackground),get("#backgroundDelete").addEventListener("click",()=>{get("#blankPopup").style.display="block",get("#popup").style.display="flex",get("#popupText").innerHTML=CONTENT.popupBackground,get("#popupAccept").addEventListener("click",resetBackground),get("#popupCancel").addEventListener("click",()=>{get("#popupAccept").removeEventListener("click",resetBackground),get("#blankPopup").style.display="none",get("#popup").style.display="none"})}),1==settings.profile.displayName&&(get("#preferenceName").checked=!0),1==settings.profile.displayDate&&(get("#preferenceDate").checked=!0),1==settings.profile.displayWeather&&(get("#preferenceWeather").checked=!0),get("#preferenceName").addEventListener("click",()=>{checkPreference("name")}),get("#preferenceDate").addEventListener("click",()=>{checkPreference("date")}),get("#preferenceWeather").addEventListener("click",()=>{checkPreference("weather")}),1==settings.style.darkenBackground&&(get("#preferenceBackground").checked=!0),get("#preferenceBackground").addEventListener("click",()=>{checkPreference("background")}),get("#color1").value=settings.style.color1,get("#color2").value=settings.style.color2,get("#color3").value=settings.style.color3,get("#colorConfirm").addEventListener("click",modifyTheme),get("#colorReset").addEventListener("click",()=>{get("#blankPopup").style.display="block",get("#popup").style.display="flex",get("#popupText").innerHTML=CONTENT.popupResetColor,get("#popupAccept").addEventListener("click",resetTheme),get("#popupCancel").addEventListener("click",()=>{get("#popupAccept").removeEventListener("click",resetColor),get("#blankPopup").style.display="none",get("#popup").style.display="none"})}),get("#switchLanguage").addEventListener("click",switchLanguage),get("#importData").style.color=getVariableCSS("label-text"),get("#importConfirm").addEventListener("click",importData),get("#exportData").addEventListener("click",()=>{get("#blankPopup").style.display="block",get("#popup").style.display="flex",get("#popupText").innerHTML=CONTENT.popupBackup,get("#popupAccept").addEventListener("click",exportData),get("#popupCancel").addEventListener("click",()=>{get("#popupAccept").removeEventListener("click",exportData),get("#blankPopup").style.display="none",get("#popup").style.display="none"})}),get("#logout").addEventListener("click",()=>{get("#blankPopup").style.display="block",get("#popup").style.display="flex",get("#popupText").innerHTML=CONTENT.popupLogout,get("#popupAccept").addEventListener("click",logout),get("#popupCancel").addEventListener("click",()=>{get("#popupAccept").removeEventListener("click",logout),get("#blankPopup").style.display="none",get("#popup").style.display="none"})})}function closeMenu(){for(let e=0;e<get(".listSettingsTitle").length;e++)get(".listSettingsTitle")[e].nextElementSibling.style.display="none";get("#displaySettings").style.display="block",get("#listSettings").style.display="none",get("#blankPage").style.display="none",resetMenu()}function managingSubMenu(){let e=!1;const t=get(".listSettingsTitle");""==settings.style.background?(get("#backgroundDelete").style.display="none",get("#darkenBackground").style.display="none"):get("#backgroundColor").style.display="none";for(let n=0;n<t.length;n++)get(".listSettingsTitle")[n].nextElementSibling.style.display="none",t[n].addEventListener("click",()=>{if(resetMenu(),"none"==t[n].nextElementSibling.style.display){if(e)for(let e=0;e<t.length;e++)t[e].nextElementSibling.style.display="none";n==t.length-1?t[n].nextElementSibling.style.display="flex":t[n].nextElementSibling.style.display="block",e=!0}else t[n].nextElementSibling.style.display="none"})}function resetMenu(){get("#profileLabel").style.color=getVariableCSS("label-text"),get("#weatherAPILabel").style.color=getVariableCSS("label-text"),get("#weatherTownLabel").style.color=getVariableCSS("label-text"),get("#backgroundLabel").style.color=getVariableCSS("label-text"),get("#importLabel").style.color=getVariableCSS("label-text")}function displayApp(){const e=new Date;let t=e.toLocaleString(CONTENT.dateLanguage,{weekday:"long",month:"long",day:"numeric"}),n=e.getHours(),l=e.getMinutes();n<10&&(n="0"+n),l<10&&(l="0"+l);const a=e.getHours()<7||e.getHours()>19?CONTENT.welcomeNight:CONTENT.welcomeDay,s=""!=settings.profile.name?' <span id="displayName">'+settings.profile.name+"</span>":"";get("#displayTime").innerHTML=n+":"+l,get("#displayDate").innerHTML=ucFirst(t.split(" ")[0])+" "+t.split(" ")[1]+" "+ucFirst(t.split(" ")[2]),get("#displayWelcome").innerHTML=a+s}function changeProfile(){get("#newName").checkValidity()&&""!=get("#newName").value?(get("#profileLabel").style.color=getVariableCSS("label-text"),settings.profile.name=get("#newName").value,saveSettings()):get("#profileLabel").style.color=getVariableCSS("error-text")}function changeWeather(){""!=get("#weatherAPIValue").value&&""!=get("#weatherTownValue").value?(get("#weatherAPILabel").style.color=getVariableCSS("label-text"),get("#weatherTownLabel").style.color=getVariableCSS("label-text"),settings.weather.api=get("#weatherAPIValue").value,settings.weather.town=get("#weatherTownValue").value,saveSettings(),displayWeather()):(get("#weatherAPILabel").style.color=getVariableCSS("error-text"),get("#weatherTownLabel").style.color=getVariableCSS("error-text"))}function displayWeather(){settings.profile.displayWeather&&""!=settings.weather.api&&""!=settings.weather.town?(requestWeather(),setInterval(requestWeather,18e5),get("#displayWeather").style.display="block"):get("#displayWeather").style.display="none"}async function requestWeather(){const e=new Request("https://api.openweathermap.org/data/2.5/weather?q="+settings.weather.town+"&appid="+settings.weather.api+"&lang="+CONTENT.weatherLanguage+"&units=metric");await fetch(e).then(e=>e.json()).then(e=>{let t,n=new Date;if(n.getHours()<7||n.getHours()>19)t="ğŸŒ™";else switch(e.weather[0].main){case"Clear":t="â˜€ï¸";break;case"Clouds":t="â›…";break;case"Drizzle":case"Rain":t="ğŸŒ§ï¸";break;case"Snow":t="â„ï¸";break;case"Thunderstorm":case"Atmosphere":t="ğŸŒ©ï¸";break;case"Fog":case"Mist":t="ğŸŒ«ï¸";break;default:t="â“",console.log(e.weather[0].main)}get("#displayWeather").innerHTML=t+" "+Math.round(e.main.temp)+" <sup>Â°c</sup>"}).catch(e=>{console.log(e),get("#displayWeather").innerHTML="â“"})}function checkPreference(e){switch(e){case"all":checkPreference("name"),checkPreference("date"),checkPreference("weather"),checkPreference("background");break;case"name":settings.profile.displayName=1==get("#preferenceName").checked,get("#displayWelcome").style.display=settings.profile.displayName?"block":"none";break;case"date":settings.profile.displayDate=1==get("#preferenceDate").checked,get("#displayDate").style.display=settings.profile.displayDate?"block":"none";break;case"weather":settings.profile.displayWeather=1==get("#preferenceWeather").checked,displayWeather();break;case"background":settings.style.darkenBackground=1==get("#preferenceBackground").checked,displayTheme()}saveSettings()}function displayTheme(){if(get("#css").innerHTML=":root { --color-1 : "+settings.style.color1+"; --color-2 : "+settings.style.color2+"; --color-3 : "+settings.style.color3+"; }",""!=settings.style.background){const e="url("+settings.style.background.replace(/(\r\n|\n|\r)/gm,"")+")",t="linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)),";get("#app").style.backgroundImage=settings.style.darkenBackground?t+e:e}}function modifyTheme(){settings.style.color1=get("#color1").value,settings.style.color2=get("#color2").value,settings.style.color3=get("#color3").value,saveSettings(),displayTheme()}function resetTheme(){settings.style.color1=DEFAULT_VALUES.color1,settings.style.color2=DEFAULT_VALUES.color2,settings.style.color3=DEFAULT_VALUES.color3,saveSettings(),displayTheme()}function modifyBackground(){const e=["jpg","jpeg","png"],t=get("#backgroundValue");if(t.files&&t.files[0]){const n=t.files[0].name.split(".").pop().toLowerCase();if(e.indexOf(n)>-1){let e=new FileReader;e.readAsDataURL(t.files[0]),e.onload=(e=>{let n=e.target.result;settings.style.background=n,t.value=null,saveSettings(),location.reload()})}else get("#backgroundLabel").style.color=getVariableCSS("error-text")}else get("#backgroundLabel").style.color=getVariableCSS("error-text")}function resetBackground(){settings.style.background="",saveSettings(),location.reload()}function saveSettings(){setStorage("HOMEY-settings",JSON.stringify(settings))}function importData(){const e=["json"],t=get("#importData");if(t.files&&t.files[0]){const n=t.files[0].name.split(".").pop().toLowerCase();if(e.indexOf(n)>-1){const e=new FileReader;e.readAsText(t.files[0]),e.onload=(e=>{let t=e.target.result;settings=JSON.parse(t),saveSettings(),location.reload()})}else get("#importLabel").style.color=getVariableCSS("error-text")}else get("#importLabel").style.color=getVariableCSS("error-text")}function switchLanguage(){settings.core.language="FR"==settings.core.language?"EN":"FR",saveSettings(),location.reload()}function exportData(){download(JSON.stringify(settings),"homey.json"),get("#popupAccept").removeEventListener("click",exportData),get("#blankPopup").style.display="none",get("#popup").style.display="none"}function logout(){remStorage("HOMEY-settings"),location.reload()}function checkVersion(){settings.core.version!=VERSION&&(settings.core.language||(settings.core.language=DEFAULT_VALUES.language),settings.core.start&&delete settings.core.start,settings.style.theme&&delete settings.style.theme,settings.core.version=VERSION,saveSettings(),settings.style.color1||resetTheme())}checkVersion(),displayTheme(),createMenu(),managingSubMenu(),checkPreference("all"),displayApp(),setInterval(displayApp,1e3);