function createMenuAtStart(){get("#startApp").addEventListener("click",()=>{SETTINGS.core.start=!0,saveSettings(),location.reload()}),get("#importConfirm").addEventListener("click",()=>{if(0!=get("#importData").files.length){let e=new FileReader;e.readAsText(get("#importData").files[0]),e.onload=(e=>{let t=e.target.result;SETTINGS=JSON.parse(t),saveSettings(),location.reload()})}else get("#importData").style.color=getVariableCSS("errorText")})}function createMenuAtLoad(){get("#displaySettings").addEventListener("click",()=>{get("#blankPage").style.display="flex",get("#displaySettings").style.display="none",get("#listSettings").style.animation="fadeInRight",get("#listSettings").style.animationDuration="0.5s",get("#listSettings").style.display="flex"}),get("#closeSettings").addEventListener("click",closeMenu),get("#blankPage").addEventListener("click",closeMenu),get("#newName").value=SETTINGS.profile.name,get("#weatherAPIValue").value=SETTINGS.weather.api,get("#weatherTownValue").value=SETTINGS.weather.town,get("#profileConfirm").addEventListener("click",changeProfile),get("#weatherConfirm").addEventListener("click",changeWeather),get("#backgroundConfirm").addEventListener("click",changeBackground),get("#switchTheme").addEventListener("click",switchTheme),get("#exportData").addEventListener("click",()=>{confirm(_CONTENT.backupText)&&download(JSON.stringify(SETTINGS),"homey.json")}),get("#logout").addEventListener("click",()=>{confirm(_CONTENT.logoutText)&&(storage("rem","HOMEY-settings"),location.reload())})}function closeMenu(){for(let e=0;e<get(".listSettingsTitle").length-1;e++)get(".listSettingsTitle")[e].nextElementSibling.style.display="none",get(".listSettingsTitle")[e].innerHTML="▼ "+get(".listSettingsTitle")[e].innerHTML.split(" ")[1];get("#displaySettings").style.display="block",get("#listSettings").style.display="none",get("#blankPage").style.display="none",get("#profileLabel").style.color=getVariableCSS("labelText"),get("#weatherAPILabel").style.color=getVariableCSS("labelText"),get("#weatherTownLabel").style.color=getVariableCSS("labelText")}function managingSubMenu(){const e=get(".listSettingsTitle");let t=!1;for(let a=0;a<e.length-1;a++)get(".listSettingsTitle")[a].nextElementSibling.style.display="none",e[a].addEventListener("click",()=>{if("none"==e[a].nextElementSibling.style.display){if(t)for(let t=0;t<e.length-1;t++)e[t].nextElementSibling.style.display="none",e[t].innerHTML="▼ "+e[t].innerHTML.split(" ")[1];e[a].innerHTML="▲ "+e[a].innerHTML.split(" ")[1],e[a].nextElementSibling.style.display="block",t=!0}else e[a].innerHTML="▼ "+e[a].innerHTML.split(" ")[1],e[a].nextElementSibling.style.display="none"})}function displayApp(){let e=new Date,t=e.toLocaleString(_CONTENT.dateLanguage,{weekday:"long",month:"long",day:"numeric"}),a=e.getHours(),l=e.getMinutes();a<10&&(a="0"+a),l<10&&(l="0"+l);let n=e.getHours()<7||e.getHours()>19?_CONTENT.welcomeNight:_CONTENT.welcomeDay,i=""!=SETTINGS.profile.name?' <span id="displayName">'+SETTINGS.profile.name+"</span>":"";get("#displayTime").innerHTML=a+":"+l,get("#displayDate").innerHTML=t,get("#displayWelcome").innerHTML=n+i}function displayWeatherInfo(){""!=SETTINGS.weather.api&&""!=SETTINGS.weather.town?(requestWeather(),setInterval(requestWeather,18e5),get("#displayWeather").style.display="block"):(get("#displayWeather").innerHTML="",get("#displayWeather").style.display="none")}function changeProfile(){get("#newName").checkValidity()&&""!=get("#newName").value?(get("#profileLabel").style.color=getVariableCSS("labelText"),SETTINGS.profile.name=get("#newName").value,saveSettings()):get("#profileLabel").style.color=getVariableCSS("errorText")}function changeWeather(){""!=get("#weatherAPIValue").value&&""!=get("#weatherTownValue").value?(get("#weatherAPILabel").style.color=getVariableCSS("labelText"),get("#weatherTownLabel").style.color=getVariableCSS("labelText"),SETTINGS.weather.api=get("#weatherAPIValue").value,SETTINGS.weather.town=get("#weatherTownValue").value,saveSettings(),displayWeatherInfo()):(get("#weatherAPILabel").style.color=getVariableCSS("errorText"),get("#weatherTownLabel").style.color=getVariableCSS("errorText"))}function requestWeather(){const e=new Request("https://api.openweathermap.org/data/2.5/weather?q="+SETTINGS.weather.town+"&appid="+SETTINGS.weather.api+"&lang="+_CONTENT.weatherLanguage+"&units=metric");fetch(e).then(e=>e.json()).then(e=>{let t,a=new Date;if(a.getHours()<7||a.getHours()>19)t="🌙";else switch(e.weather[0].main){case"Clear":t="☀️";break;case"Clouds":t="⛅";break;case"Drizzle":case"Rain":t="🌧️";break;case"Snow":t="❄️";break;case"Thunderstorm":case"Atmosphere":t="🌩️";break;case"Fog":case"Mist":t="🌫️";break;default:t="❓",console.log(e.weather[0].main)}get("#displayWeather").innerHTML=t+" "+Math.round(e.main.temp)+" <sup>°c</sup>"}).catch(e=>{console.log(e),get("#displayWeather").innerHTML="❓"})}function switchTheme(){"classic"==SETTINGS.style.theme?(displayTheme("load","custom"),SETTINGS.style.theme="custom"):"custom"==SETTINGS.style.theme&&(displayTheme("load","classic"),SETTINGS.style.theme="classic"),saveSettings()}function displayTheme(e,t=null){""!=SETTINGS.style.background&&(get("#app").style.backgroundImage="url("+SETTINGS.style.background.replace(/(\r\n|\n|\r)/gm,"")+")"),"auto"==e?displayTheme("load",SETTINGS.profile.theme):"classic"==t?get("#theme").href="assets/css/theme-classic.css":"custom"==t&&(get("#theme").href="assets/css/theme-custom.css")}function changeBackground(){if(0!=get("#backgroundValue").files.length){let e=new FileReader;e.readAsDataURL(get("#backgroundValue").files[0]),e.onload=(e=>{let t=e.target.result;SETTINGS.style.background=t,get("#backgroundValue").value=null,saveSettings(),location.reload()})}else get("#backgroundLabel").style.color=getVariableCSS("errorText")}function saveSettings(){storage("set","HOMEY-settings",JSON.stringify(SETTINGS))}function checkVersion(){SETTINGS.core.version!=_VERSION&&(SETTINGS.core.version=_VERSION,saveSettings())}0==SETTINGS.core.start?(get("#start").style.display="flex",get("#importData").value="",createMenuAtStart()):(get("#start").style.display="none",get("#app").style.display="flex",displayApp(),setInterval(displayApp,1e3),displayTheme("auto"),displayWeatherInfo(),checkVersion(),createMenuAtLoad(),managingSubMenu());